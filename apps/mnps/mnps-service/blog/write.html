<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNPS Blog - Write</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="assets/css/blog.css">
    <!-- Toast UI -->
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/theme/toastui-editor-dark.min.css" />
</head>

<body>
    <nav class="navbar">
        <a href="/index.html" class="nav-logo">MNPS</a>
        <div class="nav-links">
            <a href="/blog/index.html" class="nav-link">블로그</a>
            <a href="/blog/write.html" class="nav-link" style="color: #fff;">글쓰기</a>
            <div class="auth-buttons">
                <a href="/login.html" class="nav-btn btn-login">로그인</a>
                <a href="/signup.html" class="nav-btn btn-signup">회원가입</a>
            </div>
        </div>
    </nav>

    <div id="particles-js"></div>

    <div class="frame-content">
        <div class="editor-container">
            <header class="blog-header">
                <h1 class="blog-title">NEW POST</h1>
                <p class="blog-subtitle">새로운 통찰을 기록하십시오.</p>
            </header>

            <form id="write-form" onsubmit="submitPost(event)">
                <div class="form-group">
                    <label class="form-label">제목</label>
                    <input type="text" id="title" class="form-input" placeholder="제목을 입력하세요" required>
                </div>
                <div class="form-group">
                    <label class="form-label">작성자</label>
                    <input type="text" id="author" class="form-input" value="MNPS Editor">
                </div>
                <div class="form-group">
                    <label class="form-label">대표 이미지 URL</label>
                    <input type="url" id="image" class="form-input" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label">태그</label>
                    <input type="text" id="tags" class="form-input" placeholder="태그 입력">
                </div>
                <div class="form-group">
                    <label class="form-label">본문</label>
                    <div id="editor"></div>
                </div>
                <button type="submit" class="btn-publish">발행하기</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script>
        particlesJS.load('particles-js', '/assets/particles.json', function () { });

        const editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '500px',
            initialEditType: 'wysiwyg',
            previewStyle: 'vertical',
            theme: 'dark',
            toolbarItems: [
                ['heading', 'bold', 'italic', 'strike'],
                ['hr', 'quote'],
                ['ul', 'ol', 'task'],
                ['table', 'image', 'link'],
                ['code', 'codeblock']
            ]
        });

        async function submitPost(event) {
            event.preventDefault();
            const postData = {
                title: document.getElementById('title').value,
                author: document.getElementById('author').value,
                image: document.getElementById('image').value,
                tags: document.getElementById('tags').value,
                content: editor.getHTML()
            };

            try {
                const response = await fetch('/api/blog/posts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });
                const result = await response.json();
                if (result.success) {
                    alert('발행되었습니다.');
                    location.href = 'index.html';
                } else {
                    alert('실패: ' + result.error);
                }
            } catch (error) { console.error('Error:', error); }
        }
    </script>
</body>

</html>