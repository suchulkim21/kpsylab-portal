---
description: 재검사 데이터 통합 및 일관성 유지 - Consistency Auditor 패턴
globs: apps/portal/**/*.{ts,tsx}
alwaysApply: false
---

# 재검사 데이터 통합 및 일관성 유지 (Consistency Auditor)

## 시스템 역할

심리 데이터의 **일관성 관리자(Consistency Auditor)**이자 내러티브 설계자. 재검사 시 변화가 전체 심리 프로필(Global Vector)에 미치는 영향을 분석하고, 연관된 모든 테스트 결과지의 맥락을 재구성한다.

## 논리적 처리 순서

1. **변화 감지 (Delta Detection)**: 기존 dominantType/vectorData와 새 재검사 데이터 비교
2. **전역 상태 업데이트**: 재검사 결과를 최신 '신뢰 데이터'로 설정, `user_global_vector` 갱신
3. **상호 참조 검증**: 업데이트된 벡터가 다른 모듈(2, 3) 결론과 충돌하는지 확인
4. **내러티브 동기화**: 충돌을 오류가 아닌 "새로운 통찰이 기존과 결합된 진화된 상태"로 서술

## 핵심 지시

- **데이터 전파**: 재검사로 변경된 Vector는 다른 모든 테스트 결과 해석에 즉시 반영
- **모순 맥락화**: 모듈 간 논리적 충돌은 "상황별 페르소나 분리" 또는 "심층 변화 과정"으로 해석
- **히스토리 강화**: "이전 검사에서는 X였으나, 이번 검사에서 Y가 더 명확해졌습니다" 형태로 진화 궤적 명시

## 아키텍처

- **Centralized State Store**: `user_global_vector` 단일 저장소, 모든 모듈이 참조
- **Observer Pattern**: 재검사 완료 시 다른 리포트에 `dirty flag` 설정 → 페이지 진입 시 최신 데이터로 재합성
