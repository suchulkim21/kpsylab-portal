# 인증 시스템 구현 완료

## ✅ 구현된 기능

### 1. 회원가입 및 로그인 시스템
- **사용자 데이터베이스**: SQLite 기반 사용자 관리 (`data/users.db`)
- **회원가입 API**: `/api/auth/register` - 사용자명, 이메일, 비밀번호로 회원가입
- **로그인 API**: `/api/auth/login` - JWT 토큰 기반 인증
- **로그아웃 API**: `/api/auth/logout` - 쿠키 삭제
- **현재 사용자 정보 API**: `/api/auth/me` - JWT 토큰 검증 및 사용자 정보 반환

### 2. 인증 컨텍스트 (AuthContext)
- 전역 인증 상태 관리
- 로그인/회원가입/로그아웃 함수 제공
- 자동 사용자 정보 조회 및 갱신

### 3. 네비게이션 바
- 로그인하지 않은 사용자: "로그인", "회원가입" 버튼 표시
- 로그인한 사용자: 사용자명과 드롭다운 메뉴 (로그아웃 포함)

### 4. 로그인/회원가입 페이지
- **로그인 페이지**: `/login` - 이메일/비밀번호 입력
- **회원가입 페이지**: `/register` - 사용자명, 이메일, 비밀번호, 비밀번호 확인 입력
- 반응형 디자인 및 에러 처리

### 5. 게시판 개선
- **로그인한 사용자**: 작성자 이름 자동 입력 (수정 불가)
- **비회원**: 작성자 이름 직접 입력 가능
- 비회원도 게시글 작성 가능 (기존 기능 유지)

### 6. 문의 게시판
- 비회원도 문의 작성 가능 (이메일 선택사항, localStorage로 내 문의 추적)
- 기존 기능 유지

## 🔐 보안 기능

1. **비밀번호 해싱**: PBKDF2 + Salt 사용
2. **JWT 토큰**: 7일 유효기간, httpOnly 쿠키에 저장
3. **입력 검증**: 
   - 사용자명: 3-20자
   - 비밀번호: 최소 6자
   - 이메일 형식 검증
   - 중복 이메일/사용자명 검증

## 📁 데이터베이스 구조

### users 테이블
- `id`: INTEGER PRIMARY KEY
- `username`: TEXT UNIQUE
- `email`: TEXT UNIQUE
- `password_hash`: TEXT
- `created_at`: TEXT
- `updated_at`: TEXT

### test_results 테이블 (기본 구조 생성됨)
- `id`: INTEGER PRIMARY KEY
- `user_id`: INTEGER (회원인 경우)
- `test_type`: TEXT (예: 'mnps', 'second-genesis-module1' 등)
- `test_data`: TEXT (JSON 형식)
- `created_at`: TEXT

## 🚀 사용 방법

### 로그인하지 않은 사용자
1. 네비게이션 바에서 "회원가입" 클릭
2. 사용자명, 이메일, 비밀번호 입력 후 가입
3. 자동으로 로그인됨

### 로그인한 사용자
- 네비게이션 바에 사용자명 표시
- 게시판 작성 시 작성자 이름 자동 입력
- 테스트 결과 자동 저장 (구현 예정)

## 📝 다음 단계 (추가 구현 필요)

### 테스트 결과 저장 기능

#### 회원 (로그인한 사용자)
- 테스트 완료 시 `test_results` 테이블에 자동 저장
- `saveTestResult(userId, testType, testData)` 함수 사용
- 저장된 결과는 `/api/test-results` API로 조회 가능

#### 비회원 (로그인하지 않은 사용자)
- 테스트 완료 시 `sessionStorage` 또는 `localStorage`에 저장
- 페이지를 벗어나면 데이터 삭제 (sessionStorage) 또는 유지 (localStorage)
- 로그인 후 저장된 결과를 DB로 마이그레이션하는 옵션 제공 가능

### 테스트 결과 조회 페이지
- 로그인한 사용자의 경우 저장된 모든 테스트 결과 목록 표시
- 각 테스트 타입별 필터링
- 결과 상세 보기

## 🔧 기술 스택

- **인증**: JWT (jose 라이브러리)
- **데이터베이스**: SQLite3
- **비밀번호 해싱**: Node.js crypto (PBKDF2)
- **쿠키 관리**: Next.js cookies API

## 📌 참고사항

1. **JWT 시크릿 키**: 프로덕션 환경에서는 환경변수 `JWT_SECRET` 설정 필요
2. **HTTPS**: 프로덕션 환경에서는 쿠키의 `secure` 플래그를 `true`로 설정
3. **데이터베이스 경로**: `apps/portal/data/` 디렉토리에 자동 생성됨
4. **테스트 결과 저장**: 각 테스트 서비스(MNPS, Second Genesis)에서 API 호출 필요



